var browser={opener:{},support:{},files:[],clipboard:[],labels:[],shows:[],orders:[],cms:""};browser.initClipboard=function(){if(!this.clipboard||!this.clipboard.length){return}var b=0;$.each(this.clipboard,function(c,d){b+=parseInt(d.size)});b=this.humanSize(b);$("#clipboard").html('<div title="'+this.label("Clipboard")+" ("+this.clipboard.length+" "+this.label("files")+", "+b+')" onclick="browser.openClipboard()"></div>');var a=function(){$("#clipboard").css({left:$(window).width()-$("#clipboard").outerWidth()+"px",top:$(window).height()-$("#clipboard").outerHeight()+"px"})};a();$("#clipboard").css("display","block");$(window).unbind();$(window).resize(function(){browser.resize();a()})};browser.openClipboard=function(){if(!this.clipboard||!this.clipboard.length){return}if($('.menu a[href="kcact:cpcbd"]').html()){$("#clipboard").removeClass("selected");this.hideDialog();return}var a='<div class="menu"><div class="list">';$.each(this.clipboard,function(b,d){c=_.getFileExtension(d.name);if(d.thumb){c=".image"}else{if(!d.smallIcon||!c.length){c="."}}var c="themes/"+browser.theme+"/img/files/small/"+c+".png";a+='<a style="background-image:url('+_.escapeDirs(c)+')" title="'+browser.label("Click to remove from the Clipboard")+'" onclick="browser.removeFromClipboard('+b+')">'+_.htmlData(_.basename(d.name))+"</a>"});a+='</div><div class="delimiter"></div>';if(this.support.zip){a+='<a href="kcact:download">'+this.label("Download files")+"</a>"}if(this.access.files.copy||this.access.files.move||this.access.files["delete"]){a+='<div class="delimiter"></div>'}if(this.access.files.copy){a+='<a href="kcact:cpcbd"'+(!browser.dirWritable?' class="denied"':"")+">"+this.label("Copy files here")+"</a>"}if(this.access.files.move){a+='<a href="kcact:mvcbd"'+(!browser.dirWritable?' class="denied"':"")+">"+this.label("Move files here")+"</a>"}if(this.access.files["delete"]){a+='<a href="kcact:rmcbd">'+this.label("Delete files")+"</a>"}a+='<div class="delimiter"></div><a href="kcact:clrcbd">'+this.label("Clear the Clipboard")+"</a></div>";setTimeout(function(){$("#clipboard").addClass("selected");$("#dialog").html(a);$('.menu a[href="kcact:download"]').click(function(){browser.hideDialog();browser.downloadClipboard();return false});$('.menu a[href="kcact:cpcbd"]').click(function(){if(!browser.dirWritable){return false}browser.hideDialog();browser.copyClipboard(browser.dir);return false});$('.menu a[href="kcact:mvcbd"]').click(function(){if(!browser.dirWritable){return false}browser.hideDialog();browser.moveClipboard(browser.dir);return false});$('.menu a[href="kcact:rmcbd"]').click(function(){browser.hideDialog();browser.confirm(browser.label("Are you sure you want to delete all files in the Clipboard?"),function(e){if(e){e()}browser.deleteClipboard()});return false});$('.menu a[href="kcact:clrcbd"]').click(function(){browser.hideDialog();browser.clearClipboard();return false});var c=$(window).width()-$("#dialog").outerWidth();var b=$(window).height()-$("#dialog").outerHeight()-$("#clipboard").outerHeight();var d=b+_.outerTopSpace("#dialog");$(".menu .list").css("max-height",d+"px");var b=$(window).height()-$("#dialog").outerHeight()-$("#clipboard").outerHeight();$("#dialog").css({left:(c-4)+"px",top:b+"px"});$("#dialog").fadeIn()},1)};browser.removeFromClipboard=function(a){if(!this.clipboard||!this.clipboard[a]){return false}if(this.clipboard.length==1){this.clearClipboard();this.hideDialog();return}if(a<this.clipboard.length-1){var b=this.clipboard.slice(a+1);this.clipboard=this.clipboard.slice(0,a);this.clipboard=this.clipboard.concat(b)}else{this.clipboard.pop()}this.initClipboard();this.hideDialog();this.openClipboard();return true};browser.copyClipboard=function(b){if(!this.clipboard||!this.clipboard.length){return}var d=[];var a=0;for(i=0;i<this.clipboard.length;i++){if(this.clipboard[i].readable){d[i]=this.clipboard[i].dir+"/"+this.clipboard[i].name}else{a++}}if(this.clipboard.length==a){browser.alert(this.label("The files in the Clipboard are not readable."));return}var c=function(e){if(b==browser.dir){browser.fadeFiles()}$.ajax({type:"POST",dataType:"json",url:browser.baseGetData("cp_cbd"),data:{dir:b,files:d},async:false,success:function(f){if(e){e()}browser.check4errors(f);browser.clearClipboard();if(b==browser.dir){browser.refresh()}},error:function(){if(e){e()}$("#files > div").css({opacity:"",filter:""});browser.alert(browser.label("Unknown error."))}})};if(a){browser.confirm(browser.label("{count} files in the Clipboard are not readable. Do you want to copy the rest?",{count:a}),c)}else{c()}};browser.moveClipboard=function(b){if(!this.clipboard||!this.clipboard.length){return}var d=[];var a=0;for(i=0;i<this.clipboard.length;i++){if(this.clipboard[i].readable&&this.clipboard[i].writable){d[i]=this.clipboard[i].dir+"/"+this.clipboard[i].name}else{a++}}if(this.clipboard.length==a){browser.alert(this.label("The files in the Clipboard are not movable."));return}var c=function(e){browser.fadeFiles();$.ajax({type:"POST",dataType:"json",url:browser.baseGetData("mv_cbd"),data:{dir:b,files:d},async:false,success:function(f){if(e){e()}browser.check4errors(f);browser.clearClipboard();browser.refresh()},error:function(){if(e){e()}$("#files > div").css({opacity:"",filter:""});browser.alert(browser.label("Unknown error."))}})};if(a){browser.confirm(browser.label("{count} files in the Clipboard are not movable. Do you want to move the rest?",{count:a}),c)}else{c()}};browser.deleteClipboard=function(){if(!this.clipboard||!this.clipboard.length){return}var c=[];var a=0;for(i=0;i<this.clipboard.length;i++){if(this.clipboard[i].readable&&this.clipboard[i].writable){c[i]=this.clipboard[i].dir+"/"+this.clipboard[i].name}else{a++}}if(this.clipboard.length==a){browser.alert(this.label("The files in the Clipboard are not removable."));return}var b=function(d){browser.fadeFiles();$.ajax({type:"POST",dataType:"json",url:browser.baseGetData("rm_cbd"),data:{files:c},async:false,success:function(e){if(d){d()}browser.check4errors(e);browser.clearClipboard();browser.refresh()},error:function(){if(d){d()}$("#files > div").css({opacity:"",filter:""});browser.alert(browser.label("Unknown error."))}})};if(a){browser.confirm(browser.label("{count} files in the Clipboard are not removable. Do you want to delete the rest?",{count:a}),b)}else{b()}};browser.downloadClipboard=function(){if(!this.clipboard||!this.clipboard.length){return}var a=[];for(i=0;i<this.clipboard.length;i++){if(this.clipboard[i].readable){a[i]=this.clipboard[i].dir+"/"+this.clipboard[i].name}}if(a.length){this.post(this.baseGetData("downloadClipboard"),{files:a})}};browser.clearClipboard=function(){$("#clipboard").html("");this.clipboard=[]};browser.initDropUpload=function(){if((typeof(XMLHttpRequest)=="undefined")||(typeof(document.addEventListener)=="undefined")||(typeof(File)=="undefined")||(typeof(FileReader)=="undefined")){return}if(!XMLHttpRequest.prototype.sendAsBinary){XMLHttpRequest.prototype.sendAsBinary=function(s){var t=Array.prototype.map.call(s,function(u){return u.charCodeAt(0)&255});var r=new Uint8Array(t);this.send(r.buffer)}}var o=[],a=false,m=0,p=[],b=$("#files"),f=$("div.folder > a"),e="------multipartdropuploadboundary"+(new Date).getTime(),d,l=function(r){if(r.preventDefault){r.preventDefault()}$("#files").addClass("drag");return false},q=function(r){if(r.preventDefault){r.preventDefault()}return false},h=function(r){if(r.preventDefault){r.preventDefault()}$("#files").removeClass("drag");return false},k=function(t){if(t.preventDefault){t.preventDefault()}if(t.stopPropagation){t.stopPropagation()}$("#files").removeClass("drag");if(!$("#folders span.current").first().parent().data("writable")){browser.alert("Cannot write to upload folder.");return false}m+=t.dataTransfer.files.length;for(var s=0;s<t.dataTransfer.files.length;s++){var r=t.dataTransfer.files[s];r.thisTargetDir=browser.dir;o.push(r)}g();return false},n=function(r){if(r.preventDefault){r.preventDefault()}return false},j=function(u,r){if(u.preventDefault){u.preventDefault()}if(u.stopPropagation){u.stopPropagation()}if(!$(r).data("writable")){browser.alert("Cannot write to upload folder.");return false}m+=u.dataTransfer.files.length;for(var t=0;t<u.dataTransfer.files.length;t++){var s=u.dataTransfer.files[t];s.thisTargetDir=$(r).data("path");o.push(s)}g();return false};b.get(0).removeEventListener("dragover",l,false);b.get(0).removeEventListener("dragenter",q,false);b.get(0).removeEventListener("dragleave",h,false);b.get(0).removeEventListener("drop",k,false);b.get(0).addEventListener("dragover",l,false);b.get(0).addEventListener("dragenter",q,false);b.get(0).addEventListener("dragleave",h,false);b.get(0).addEventListener("drop",k,false);f.each(function(){var t=this,u=function(v){$(t).children("span.folder").addClass("context");return n(v)},s=function(v){$(t).children("span.folder").removeClass("context");return n(v)},r=function(v){$(t).children("span.folder").removeClass("context");return j(v,t)};this.removeEventListener("dragover",u,false);this.removeEventListener("dragenter",n,false);this.removeEventListener("dragleave",s,false);this.removeEventListener("drop",r,false);this.addEventListener("dragover",u,false);this.addEventListener("dragenter",n,false);this.addEventListener("dragleave",s,false);this.addEventListener("drop",r,false)});function c(r){var s=r.lengthComputable?Math.round((r.loaded*100)/r.total)+"%":Math.round(r.loaded/1024)+" KB";$("#loading").html(browser.label("Uploading file {number} of {count}... {progress}",{number:m-o.length,count:m,progress:s}))}function g(){if(a){return false}if(o&&o.length){var t=o.shift();d=t;$("#loading").html(browser.label("Uploading file {number} of {count}... {progress}",{number:m-o.length,count:m,progress:""}));$("#loading").css("display","inline");var r=new FileReader();r.thisFileName=t.name;r.thisFileType=t.type;r.thisFileSize=t.size;r.thisTargetDir=t.thisTargetDir;r.onload=function(u){a=true;var v="--"+e+'\r\nContent-Disposition: form-data; name="upload[]"';if(u.target.thisFileName){v+='; filename="'+_.utf8encode(u.target.thisFileName)+'"'}v+="\r\n";if(u.target.thisFileSize){v+="Content-Length: "+u.target.thisFileSize+"\r\n"}v+="Content-Type: "+u.target.thisFileType+"\r\n\r\n"+u.target.result+"\r\n--"+e+'\r\nContent-Disposition: form-data; name="dir"\r\n\r\n'+_.utf8encode(u.target.thisTargetDir)+"\r\n--"+e+"\r\n--"+e+"--\r\n";var w=new XMLHttpRequest();w.thisFileName=u.target.thisFileName;if(w.upload){w.upload.thisFileName=u.target.thisFileName;w.upload.addEventListener("progress",c,false)}w.open("POST",browser.baseGetData("upload"),true);w.setRequestHeader("Content-Type","multipart/form-data; boundary="+e);w.setRequestHeader("Content-Length",v.length);w.onload=function(x){$("#loading").css("display","none");if(browser.dir==r.thisTargetDir){browser.fadeFiles()}a=false;g();if(w.responseText.substr(0,1)!="/"){p[p.length]=w.responseText}};w.sendAsBinary(v)};r.onerror=function(u){$("#loading").css("display","none");a=false;g();p[p.length]=browser.label("Failed to upload {filename}!",{filename:u.target.thisFileName})};r.readAsBinaryString(t)}else{m=0;var s=setInterval(function(){if(a){return}clearInterval(s);if(d.thisTargetDir==browser.dir){browser.refresh()}e="------multipartdropuploadboundary"+(new Date).getTime();if(p.length){browser.alert(p.join("\n"));p=[]}},333)}}};browser.initFiles=function(){$(document).unbind("keydown");$(document).keydown(function(a){return !browser.selectAll(a)});$("#files").unbind();$("#files").scroll(function(){browser.hideDialog()});$(".file").unbind();$(".file").click(function(a){_.unselect();browser.selectFile($(this),a)});$(".file").rightClick(function(a){_.unselect();browser.menuFile($(this),a)});$(".file").dblclick(function(){_.unselect();browser.returnFile($(this))});$(".file").mouseup(function(){_.unselect()});$(".file").mouseout(function(){_.unselect()});$.each(this.shows,function(a,c){var b=(_.kuki.get("show"+c)=="off")?"none":"block";$("#files .file div."+c).css("display",b)});this.statusDir()};browser.showFiles=function(b,a){this.fadeFiles();setTimeout(function(){var c="";$.each(browser.files,function(f,e){var d=[];$.each(e,function(h,j){d[d.length]=h+"|"+j});d=_.md5(d.join("|"));if(_.kuki.get("view")=="list"){if(!f){c+='<table summary="list">'}var g=_.getFileExtension(e.name);if(e.thumb){g=".image"}else{if(!g.length||!e.smallIcon){g="."}}g="themes/"+browser.theme+"/img/files/small/"+g+".png";c+='<tr class="file"><td class="name" style="background-image:url('+g+')">'+_.htmlData(e.name)+'</td><td class="time">'+e.date+'</td><td class="size">'+browser.humanSize(e.size)+"</td></tr>";if(f==browser.files.length-1){c+="</table>"}}else{if(e.thumb){var g=browser.baseGetData("thumb")+"&file="+encodeURIComponent(e.name)+"&dir="+encodeURIComponent(browser.dir)+"&stamp="+d}else{if(e.smallThumb){var g=browser.uploadURL+"/"+browser.dir+"/"+e.name;g=_.escapeDirs(g).replace(/\'/g,"%27")}else{var g=e.bigIcon?_.getFileExtension(e.name):".";if(!g.length){g="."}g="themes/"+browser.theme+"/img/files/big/"+g+".png"}}c+='<div class="file"><div class="thumb" style="background-image:url(\''+g+'\')" ></div><div class="name">'+_.htmlData(e.name)+'</div><div class="time">'+e.date+'</div><div class="size">'+browser.humanSize(e.size)+"</div></div>"}});$("#files").html("<div>"+c+"<div>");$.each(browser.files,function(e,d){var f=$("#files .file").get(e);$(f).data(d);if(_.inArray(d.name,a)||((typeof a!="undefined")&&!a.push&&(d.name==a))){$(f).addClass("selected")}});$("#files > div").css({opacity:"",filter:""});if(b){b()}browser.initFiles()},200)};browser.selectFile=function(b,f){if(f.ctrlKey||f.metaKey){if(b.hasClass("selected")){b.removeClass("selected")}else{b.addClass("selected")}var c=$(".file.selected").get();var a=0;if(!c.length){this.statusDir()}else{$.each(c,function(g,e){a+=parseInt($(e).data("size"))});a=this.humanSize(a);if(c.length>1){$("#fileinfo").html(c.length+" "+this.label("selected files")+" ("+a+")")}else{var d=$(c[0]).data();$("#fileinfo").html(d.name+" ("+this.humanSize(d.size)+", "+d.date+")")}}}else{var d=b.data();$(".file").removeClass("selected");b.addClass("selected");$("#fileinfo").html(d.name+" ("+this.humanSize(d.size)+", "+d.date+")")}};browser.selectAll=function(c){if((!c.ctrlKey&&!c.metaKey)||((c.keyCode!=65)&&(c.keyCode!=97))){return false}var b=$(".file").get();if(b.length){var a=0;$.each(b,function(e,d){if(!$(d).hasClass("selected")){$(d).addClass("selected")}a+=parseInt($(d).data("size"))});a=this.humanSize(a);$("#fileinfo").html(b.length+" "+this.label("selected files")+" ("+a+")")}return true};browser.returnFile=function(c){var a=c.substr?c:browser.uploadURL+"/"+browser.dir+"/"+c.data("name");a=_.escapeDirs(a);if(this.opener.CKEditor){this.opener.CKEditor.object.tools.callFunction(this.opener.CKEditor.funcNum,a,"");window.close()}else{if(this.opener.FCKeditor){window.opener.SetUrl(a);window.close()}else{if(this.opener.TinyMCE){var d=tinyMCEPopup.getWindowArg("window");d.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=a;if(d.getImageData){d.getImageData()}if(typeof(d.ImageDialog)!="undefined"){if(d.ImageDialog.getImageData){d.ImageDialog.getImageData()}if(d.ImageDialog.showPreviewImage){d.ImageDialog.showPreviewImage(a)}}tinyMCEPopup.close()}else{if(this.opener.callBack){if(window.opener&&window.opener.KCFinder){this.opener.callBack(a);window.close()}if(window.parent&&window.parent.KCFinder){var b=$('#toolbar a[href="kcact:maximize"]');if(b.hasClass("selected")){this.maximize(b)}this.opener.callBack(a)}}else{if(this.opener.callBackMultiple){if(window.opener&&window.opener.KCFinder){this.opener.callBackMultiple([a]);window.close()}if(window.parent&&window.parent.KCFinder){var b=$('#toolbar a[href="kcact:maximize"]');if(b.hasClass("selected")){this.maximize(b)}this.opener.callBackMultiple([a])}}}}}}};browser.returnFiles=function(b){if(this.opener.callBackMultiple&&b.length){var a=[];$.each(b,function(d,c){a[d]=browser.uploadURL+"/"+browser.dir+"/"+$(c).data("name");a[d]=_.escapeDirs(a[d])});this.opener.callBackMultiple(a);if(window.opener){window.close()}}};browser.returnThumbnails=function(c){if(this.opener.callBackMultiple){var b=[];var a=0;$.each(c,function(e,d){if($(d).data("thumb")){b[a]=browser.thumbsURL+"/"+browser.dir+"/"+$(d).data("name");b[a]=_.escapeDirs(b[a++])}});this.opener.callBackMultiple(b);if(window.opener){window.close()}}};browser.menuFile=function(c,h){var f=c.data();var k=this.dir+"/"+f.name;var b=$(".file.selected").get();var g="";if(c.hasClass("selected")&&b.length&&(b.length>1)){var a=false;var d=0;var j;$.each(b,function(l,e){j=$(e).data();if(j.thumb){a=true}if(!f.writable){d++}});if(this.opener.callBackMultiple){g+='<a href="kcact:pick">'+this.label("Select")+"</a>";if(a){g+='<a href="kcact:pick_thumb">'+this.label("Select Thumbnails")+"</a>"}}if(f.thumb||f.smallThumb||this.support.zip){g+=(g.length?'<div class="delimiter"></div>':"");if(f.thumb||f.smallThumb){g+='<a href="kcact:view">'+this.label("View")+"</a>"}if(this.support.zip){g+=(g.length?'<div class="delimiter"></div>':"")+'<a href="kcact:download">'+this.label("Download")+"</a>"}}if(this.access.files.copy||this.access.files.move){g+=(g.length?'<div class="delimiter"></div>':"")+'<a href="kcact:clpbrdadd">'+this.label("Add to Clipboard")+"</a>"}if(this.access.files["delete"]){g+=(g.length?'<div class="delimiter"></div>':"")+'<a href="kcact:rm"'+((d==b.length)?' class="denied"':"")+">"+this.label("Delete")+"</a>"}if(g.length){g='<div class="menu">'+g+"</div>";$("#dialog").html(g);this.showMenu(h)}else{return}$('.menu a[href="kcact:pick"]').click(function(){browser.returnFiles(b);browser.hideDialog();return false});$('.menu a[href="kcact:pick_thumb"]').click(function(){browser.returnThumbnails(b);browser.hideDialog();return false});$('.menu a[href="kcact:download"]').click(function(){browser.hideDialog();var e=[];$.each(b,function(m,l){e[m]=$(l).data("name")});browser.post(browser.baseGetData("downloadSelected"),{dir:browser.dir,files:e});return false});$('.menu a[href="kcact:clpbrdadd"]').click(function(){browser.hideDialog();var e="";$.each(b,function(n,m){var o=$(m).data();var l=false;for(n=0;n<browser.clipboard.length;n++){if((browser.clipboard[n].name==o.name)&&(browser.clipboard[n].dir==browser.dir)){l=true;e+=o.name+": "+browser.label("This file is already added to the Clipboard.")+"\n";break}}if(!l){o.dir=browser.dir;browser.clipboard[browser.clipboard.length]=o}});browser.initClipboard();if(e.length){browser.alert(e.substr(0,e.length-1))}return false});$('.menu a[href="kcact:rm"]').click(function(){if($(this).hasClass("denied")){return false}browser.hideDialog();var e=0;var m=[];$.each(b,function(o,n){var p=$(n).data();if(!p.writable){e++}else{m[m.length]=browser.dir+"/"+p.name}});if(e==b.length){browser.alert(browser.label("The selected files are not removable."));return false}var l=function(n){browser.fadeFiles();$.ajax({type:"POST",dataType:"json",url:browser.baseGetData("rm_cbd"),data:{files:m},async:false,success:function(o){if(n){n()}browser.check4errors(o);browser.refresh()},error:function(){if(n){n()}$("#files > div").css({opacity:"",filter:""});browser.alert(browser.label("Unknown error."))}})};if(e){browser.confirm(browser.label("{count} selected files are not removable. Do you want to delete the rest?",{count:e}),l)}else{browser.confirm(browser.label("Are you sure you want to delete all selected files?"),l)}return false})}else{g+='<div class="menu">';$(".file").removeClass("selected");c.addClass("selected");$("#fileinfo").html(f.name+" ("+this.humanSize(f.size)+", "+f.date+")");if(this.opener.callBack||this.opener.callBackMultiple){g+='<a href="kcact:pick">'+this.label("Select")+"</a>";if(f.thumb){g+='<a href="kcact:pick_thumb">'+this.label("Select Thumbnail")+"</a>"}g+='<div class="delimiter"></div>'}if(f.thumb||f.smallThumb){g+='<a href="kcact:view">'+this.label("View")+"</a>"}g+='<a href="kcact:download">'+this.label("Download")+"</a>";if(this.access.files.copy||this.access.files.move){g+='<div class="delimiter"></div><a href="kcact:clpbrdadd">'+this.label("Add to Clipboard")+"</a>"}if(this.access.files.rename||this.access.files["delete"]){g+='<div class="delimiter"></div>'}if(this.access.files.rename){g+='<a href="kcact:mv"'+(!f.writable?' class="denied"':"")+">"+this.label("Rename...")+"</a>"}if(this.access.files["delete"]){g+='<a href="kcact:rm"'+(!f.writable?' class="denied"':"")+">"+this.label("Delete")+"</a>"}g+="</div>";$("#dialog").html(g);this.showMenu(h);$('.menu a[href="kcact:pick"]').click(function(){browser.returnFile(c);browser.hideDialog();return false});$('.menu a[href="kcact:pick_thumb"]').click(function(){var e=browser.thumbsURL+"/"+browser.dir+"/"+f.name;browser.returnFile(e);browser.hideDialog();return false});$('.menu a[href="kcact:download"]').click(function(){var e='<form id="downloadForm" method="post" action="'+browser.baseGetData("download")+'"><input type="hidden" name="dir" /><input type="hidden" name="file" /></form>';$("#dialog").html(e);$("#downloadForm input").get(0).value=browser.dir;$("#downloadForm input").get(1).value=f.name;$("#downloadForm").submit();return false});$('.menu a[href="kcact:clpbrdadd"]').click(function(){for(i=0;i<browser.clipboard.length;i++){if((browser.clipboard[i].name==f.name)&&(browser.clipboard[i].dir==browser.dir)){browser.hideDialog();browser.alert(browser.label("This file is already added to the Clipboard."));return false}}var e=f;e.dir=browser.dir;browser.clipboard[browser.clipboard.length]=e;browser.initClipboard();browser.hideDialog();return false});$('.menu a[href="kcact:mv"]').click(function(l){if(!f.writable){return false}browser.fileNameDialog(l,{dir:browser.dir,file:f.name},"newName",f.name,browser.baseGetData("rename"),{title:"New file name:",errEmpty:"Please enter new file name.",errSlash:"Unallowable characters in file name.",errDot:"File name shouldn't begins with '.'"},function(){browser.refresh()});return false});$('.menu a[href="kcact:rm"]').click(function(){if(!f.writable){return false}browser.hideDialog();browser.confirm(browser.label("Are you sure you want to delete this file?"),function(e){$.ajax({type:"POST",dataType:"json",url:browser.baseGetData("delete"),data:{dir:browser.dir,file:f.name},async:false,success:function(l){if(e){e()}browser.clearClipboard();if(browser.check4errors(l)){return}browser.refresh()},error:function(){if(e){e()}browser.alert(browser.label("Unknown error."))}})});return false})}$('.menu a[href="kcact:view"]').click(function(){browser.hideDialog();var l=new Date().getTime();var e=function(n){url=_.escapeDirs(browser.uploadURL+"/"+browser.dir+"/"+n.name)+"?ts="+l,$("#loading").html(browser.label("Loading image..."));$("#loading").css("display","inline");var m=new Image();m.src=url;m.onerror=function(){browser.lock=false;$("#loading").css("display","none");browser.alert(browser.label("Unknown error."));$(document).unbind("keydown");$(document).keydown(function(p){return !browser.selectAll(p)});browser.refresh()};var o=function(){browser.lock=false;$("#files .file").each(function(){if($(this).data("name")==n.name){browser.ssImage=this}});$("#loading").css("display","none");$("#dialog").html('<div class="slideshow"><img /></div>');$("#dialog img").attr({src:url,title:n.name}).fadeIn("fast",function(){var q=$("#dialog").outerWidth();var s=$("#dialog").outerHeight();var r=$(window).width()-30;var t=$(window).height()-30;if((q>r)||(s>t)){if((r/t)>(q/s)){r=parseInt((q*t)/s)}else{if((r/t)<(q/s)){t=parseInt((s*r)/q)}}$("#dialog img").attr({width:r,height:t})}$("#dialog").unbind("click");$("#dialog").click(function(u){browser.hideDialog();$(document).unbind("keydown");$(document).keydown(function(v){return !browser.selectAll(v)});if(browser.ssImage){browser.selectFile($(browser.ssImage),u)}});browser.showDialog();var p=[];$.each(browser.files,function(v,u){if(u.thumb||u.smallThumb){p[p.length]=u}});if(p.length){$.each(p,function(u,v){if(v.name==n.name){$(document).unbind("keydown");$(document).keydown(function(x){if(p.length>1){if(!browser.lock&&(x.keyCode==37)){var w=u?p[u-1]:p[p.length-1];browser.lock=true;e(w)}if(!browser.lock&&(x.keyCode==39)){var w=(u>=p.length-1)?p[0]:p[u+1];browser.lock=true;e(w)}}if(x.keyCode==27){browser.hideDialog();$(document).unbind("keydown");$(document).keydown(function(y){return !browser.selectAll(y)})}})}})}})};if(m.complete){o()}else{m.onload=o}};e(f);return false})};browser.initFolders=function(){$("#folders").scroll(function(){browser.hideDialog()});$("div.folder > a").unbind();$("div.folder > a").bind("click",function(){browser.hideDialog();return false});$("div.folder > a > span.brace").unbind();$("div.folder > a > span.brace").click(function(){if($(this).hasClass("opened")||$(this).hasClass("closed")){browser.expandDir($(this).parent())}});$("div.folder > a > span.folder").unbind();$("div.folder > a > span.folder").click(function(){browser.changeDir($(this).parent())});$("div.folder > a > span.folder").rightClick(function(d){_.unselect();browser.menuDir($(this).parent(),d)});if($.browser.msie&&$.browser.version&&(parseInt($.browser.version.substr(0,1))<8)){var b=$("div.folder").get();var a=$("body").get(0);var c;$.each(b,function(d,e){c=document.createElement("div");c.style.display="inline";c.style.margin=c.style.border=c.style.padding="0";c.innerHTML='<table style="border-collapse:collapse;border:0;margin:0;width:0"><tr><td nowrap="nowrap" style="white-space:nowrap;padding:0;border:0">'+$(e).html()+"</td></tr></table>";a.appendChild(c);$(e).css("width",$(c).innerWidth()+"px");a.removeChild(c)})}};browser.setTreeData=function(b,c){if(!c){c=""}else{if(c.length&&(c.substr(c.length-1,1)!="/")){c+="/"}}c+=b.name;var a='#folders a[href="kcdir:/'+_.escapeDirs(c)+'"]';$(a).data({name:b.name,path:c,readable:b.readable,writable:b.writable,removable:b.removable,hasDirs:b.hasDirs});$(a+" span.folder").addClass(b.current?"current":"regular");if(b.dirs&&b.dirs.length){$(a+" span.brace").addClass("opened");$.each(b.dirs,function(e,d){browser.setTreeData(d,c+"/")})}else{if(b.hasDirs){$(a+" span.brace").addClass("closed")}}};browser.buildTree=function(a,d){if(!d){d=""}d+=a.name;var c='<div class="folder"><a href="kcdir:/'+_.escapeDirs(d)+'"><span class="brace">&nbsp;</span><span class="folder">'+_.htmlData(a.name)+"</span></a>";if(a.dirs){c+='<div class="folders">';for(var b=0;b<a.dirs.length;b++){cdir=a.dirs[b];c+=browser.buildTree(cdir,d+"/")}c+="</div>"}c+="</div>";return c};browser.expandDir=function(a){var b=a.data("path");if(a.children(".brace").hasClass("opened")){a.parent().children(".folders").hide(500,function(){if(b==browser.dir.substr(0,b.length)){browser.changeDir(a)}});a.children(".brace").removeClass("opened");a.children(".brace").addClass("closed")}else{if(a.parent().children(".folders").get(0)){a.parent().children(".folders").show(500);a.children(".brace").removeClass("closed");a.children(".brace").addClass("opened")}else{if(!$("#loadingDirs").get(0)){a.parent().append('<div id="loadingDirs">'+this.label("Loading folders...")+"</div>");$("#loadingDirs").css("display","none");$("#loadingDirs").show(200,function(){$.ajax({type:"POST",dataType:"json",url:browser.baseGetData("expand"),data:{dir:b},async:false,success:function(e){$("#loadingDirs").hide(200,function(){$("#loadingDirs").detach()});if(browser.check4errors(e)){return}var d="";$.each(e.dirs,function(g,f){d+='<div class="folder"><a href="kcdir:/'+_.escapeDirs(b+"/"+f.name)+'"><span class="brace">&nbsp;</span><span class="folder">'+_.htmlData(f.name)+"</span></a></div>"});if(d.length){a.parent().append('<div class="folders">'+d+"</div>");var c=$(a.parent().children(".folders").first());c.css("display","none");$(c).show(500);$.each(e.dirs,function(g,f){browser.setTreeData(f,b)})}if(e.dirs.length){a.children(".brace").removeClass("closed");a.children(".brace").addClass("opened")}else{a.children(".brace").removeClass("opened");a.children(".brace").removeClass("closed")}browser.initFolders();browser.initDropUpload()},error:function(){$("#loadingDirs").detach();browser.alert(browser.label("Unknown error."))}})})}}}};browser.changeDir=function(a){if(a.children("span.folder").hasClass("regular")){$("div.folder > a > span.folder").removeClass("current");$("div.folder > a > span.folder").removeClass("regular");$("div.folder > a > span.folder").addClass("regular");a.children("span.folder").removeClass("regular");a.children("span.folder").addClass("current");$("#files").html(browser.label("Loading files..."));$.ajax({type:"POST",dataType:"json",url:browser.baseGetData("chDir"),data:{dir:a.data("path")},async:false,success:function(b){if(browser.check4errors(b)){return}browser.files=b.files;browser.orderFiles();browser.dir=a.data("path");browser.dirWritable=b.dirWritable;var c="KCFinder: /"+browser.dir;document.title=c;if(browser.opener.TinyMCE){tinyMCEPopup.editor.windowManager.setTitle(window,c)}browser.statusDir()},error:function(){$("#files").html(browser.label("Unknown error."))}})}};browser.statusDir=function(){for(var b=0,a=0;b<this.files.length;b++){a+=parseInt(this.files[b].size)}a=this.humanSize(a);$("#fileinfo").html(this.files.length+" "+this.label("files")+" ("+a+")")};browser.menuDir=function(a,d){var c=a.data();var b='<div class="menu">';if(this.clipboard&&this.clipboard.length){if(this.access.files.copy){b+='<a href="kcact:cpcbd"'+(!c.writable?' class="denied"':"")+">"+this.label("Copy {count} files",{count:this.clipboard.length})+"</a>"}if(this.access.files.move){b+='<a href="kcact:mvcbd"'+(!c.writable?' class="denied"':"")+">"+this.label("Move {count} files",{count:this.clipboard.length})+"</a>"}if(this.access.files.copy||this.access.files.move){b+='<div class="delimiter"></div>'}}b+='<a href="kcact:refresh">'+this.label("Refresh")+"</a>";if(this.support.zip){b+='<div class="delimiter"></div><a href="kcact:download">'+this.label("Download")+"</a>"}if(this.access.dirs.create||this.access.dirs.rename||this.access.dirs["delete"]){b+='<div class="delimiter"></div>'}if(this.access.dirs.create){b+='<a href="kcact:mkdir"'+(!c.writable?' class="denied"':"")+">"+this.label("New Subfolder...")+"</a>"}if(this.access.dirs.rename){b+='<a href="kcact:mvdir"'+(!c.removable?' class="denied"':"")+">"+this.label("Rename...")+"</a>"}if(this.access.dirs["delete"]){b+='<a href="kcact:rmdir"'+(!c.removable?' class="denied"':"")+">"+this.label("Delete")+"</a>"}b+="</div>";$("#dialog").html(b);this.showMenu(d);$("div.folder > a > span.folder").removeClass("context");if(a.children("span.folder").hasClass("regular")){a.children("span.folder").addClass("context")}if(this.clipboard&&this.clipboard.length&&c.writable){$('.menu a[href="kcact:cpcbd"]').click(function(){browser.hideDialog();browser.copyClipboard(c.path);return false});$('.menu a[href="kcact:mvcbd"]').click(function(){browser.hideDialog();browser.moveClipboard(c.path);return false})}$('.menu a[href="kcact:refresh"]').click(function(){browser.hideDialog();browser.refreshDir(a);return false});$('.menu a[href="kcact:download"]').click(function(){browser.hideDialog();browser.post(browser.baseGetData("downloadDir"),{dir:c.path});return false});$('.menu a[href="kcact:mkdir"]').click(function(f){if(!c.writable){return false}browser.hideDialog();browser.fileNameDialog(f,{dir:c.path},"newDir","",browser.baseGetData("newDir"),{title:"New folder name:",errEmpty:"Please enter new folder name.",errSlash:"Unallowable characters in folder name.",errDot:"Folder name shouldn't begins with '.'"},function(){browser.refreshDir(a);browser.initDropUpload();if(!c.hasDirs){a.data("hasDirs",true);a.children("span.brace").addClass("closed")}});return false});$('.menu a[href="kcact:mvdir"]').click(function(f){if(!c.removable){return false}browser.hideDialog();browser.fileNameDialog(f,{dir:c.path},"newName",c.name,browser.baseGetData("renameDir"),{title:"New folder name:",errEmpty:"Please enter new folder name.",errSlash:"Unallowable characters in folder name.",errDot:"Folder name shouldn't begins with '.'"},function(e){if(!e.name){browser.alert(browser.label("Unknown error."));return}var g=(c.path==browser.dir);a.children("span.folder").html(_.htmlData(e.name));a.data("name",e.name);a.data("path",_.dirname(c.path)+"/"+e.name);if(g){browser.dir=a.data("path")}browser.initDropUpload()},true);return false});$('.menu a[href="kcact:rmdir"]').click(function(){if(!c.removable){return false}browser.hideDialog();browser.confirm("Are you sure you want to delete this folder and all its content?",function(e){$.ajax({type:"POST",dataType:"json",url:browser.baseGetData("deleteDir"),data:{dir:c.path},async:false,success:function(f){if(e){e()}if(browser.check4errors(f)){return}a.parent().hide(500,function(){var h=a.parent().parent();var g=h.parent().children("a").first();a.parent().detach();if(!h.children("div.folder").get(0)){g.children("span.brace").first().removeClass("opened");g.children("span.brace").first().removeClass("closed");g.parent().children(".folders").detach();g.data("hasDirs",false)}if(g.data("path")==browser.dir.substr(0,g.data("path").length)){browser.changeDir(g)}browser.initDropUpload()})},error:function(){if(e){e()}browser.alert(browser.label("Unknown error."))}})});return false})};browser.refreshDir=function(a){var b=a.data("path");if(a.children(".brace").hasClass("opened")||a.children(".brace").hasClass("closed")){a.children(".brace").removeClass("opened");a.children(".brace").addClass("closed")}a.parent().children(".folders").first().detach();if(b==browser.dir.substr(0,b.length)){browser.changeDir(a)}browser.expandDir(a);return true};browser.init=function(){if(!this.checkAgent()){return}$("body").click(function(){browser.hideDialog()});$("#shadow").click(function(){return false});$("#dialog").unbind();$("#dialog").click(function(){return false});$("#alert").unbind();$("#alert").click(function(){return false});this.initOpeners();this.initSettings();this.initContent();this.initToolbar();this.initResizer();this.initDropUpload()};browser.checkAgent=function(){if(!$.browser.version||($.browser.msie&&(parseInt($.browser.version)<7)&&!this.support.chromeFrame)||($.browser.opera&&(parseInt($.browser.version)<10))||($.browser.mozilla&&(parseFloat($.browser.version.replace(/^(\d+(\.\d+)?)([^\d].*)?$/,"$1"))<1.8))){var a='<div style="padding:10px">Your browser is not capable to display KCFinder. Please update your browser or install another one: <a href="http://www.mozilla.com/firefox/" target="_blank">Mozilla Firefox</a>, <a href="http://www.apple.com/safari" target="_blank">Apple Safari</a>, <a href="http://www.google.com/chrome" target="_blank">Google Chrome</a>, <a href="http://www.opera.com/browser" target="_blank">Opera</a>.';if($.browser.msie){a+=' You may also install <a href="http://www.google.com/chromeframe" target="_blank">Google Chrome Frame ActiveX plugin</a> to get Internet Explorer 6 working.'}a+="</div>";$("body").html(a);return false}return true};browser.initOpeners=function(){if(this.opener.TinyMCE&&(typeof(tinyMCEPopup)=="undefined")){this.opener.TinyMCE=null}if(this.opener.TinyMCE){this.opener.callBack=true}if((!this.opener.name||(this.opener.name=="fckeditor"))&&window.opener&&window.opener.SetUrl){this.opener.FCKeditor=true;this.opener.callBack=true}if(this.opener.CKEditor){if(window.parent&&window.parent.CKEDITOR){this.opener.CKEditor.object=window.parent.CKEDITOR}else{if(window.opener&&window.opener.CKEDITOR){this.opener.CKEditor.object=window.opener.CKEDITOR;this.opener.callBack=true}else{this.opener.CKEditor=null}}}if(!this.opener.CKEditor&&!this.opener.FCKEditor&&!this.TinyMCE){if((window.opener&&window.opener.KCFinder&&window.opener.KCFinder.callBack)||(window.parent&&window.parent.KCFinder&&window.parent.KCFinder.callBack)){this.opener.callBack=window.opener?window.opener.KCFinder.callBack:window.parent.KCFinder.callBack}if((window.opener&&window.opener.KCFinder&&window.opener.KCFinder.callBackMultiple)||(window.parent&&window.parent.KCFinder&&window.parent.KCFinder.callBackMultiple)){this.opener.callBackMultiple=window.opener?window.opener.KCFinder.callBackMultiple:window.parent.KCFinder.callBackMultiple}}};browser.initContent=function(){$("div#folders").html(this.label("Loading folders..."));$("div#files").html(this.label("Loading files..."));$.ajax({type:"GET",dataType:"json",url:browser.baseGetData("init"),async:false,success:function(a){if(browser.check4errors(a)){return}browser.dirWritable=a.dirWritable;$("#folders").html(browser.buildTree(a.tree));browser.setTreeData(a.tree);browser.initFolders();browser.files=a.files?a.files:[];browser.orderFiles()},error:function(){$("div#folders").html(browser.label("Unknown error."));$("div#files").html(browser.label("Unknown error."))}})};browser.initResizer=function(){var b=($.browser.opera)?"move":"col-resize";$("#resizer").css("cursor",b);$("#resizer").drag("start",function(){$(this).css({opacity:"0.4",filter:"alpha(opacity:40)"});$("#all").css("cursor",b)});$("#resizer").drag(function(d){var c=d.pageX-parseInt(_.nopx($(this).css("width"))/2);c=(c>=0)?c:0;c=(c+_.nopx($(this).css("width"))<$(window).width())?c:$(window).width()-_.nopx($(this).css("width"));$(this).css("left",c)});var a=function(){$(this).css({opacity:"0",filter:"alpha(opacity:0)"});$("#all").css("cursor","");var d=_.nopx($(this).css("left"))+_.nopx($(this).css("width"));var c=$(window).width()-d;$("#left").css("width",d+"px");$("#right").css("width",c+"px");_("files").style.width=$("#right").innerWidth()-_.outerHSpace("#files")+"px";_("resizer").style.left=$("#left").outerWidth()-_.outerRightSpace("#folders","m")+"px";_("resizer").style.width=_.outerRightSpace("#folders","m")+_.outerLeftSpace("#files","m")+"px";browser.fixFilesHeight()};$("#resizer").drag("end",a);$("#resizer").mouseup(a)};browser.resize=function(){_("left").style.width="25%";_("right").style.width="75%";_("toolbar").style.height=$("#toolbar a").outerHeight()+"px";_("shadow").style.width=$(window).width()+"px";_("shadow").style.height=_("resizer").style.height=$(window).height()+"px";_("left").style.height=_("right").style.height=$(window).height()-$("#status").outerHeight()+"px";_("folders").style.height=$("#left").outerHeight()-_.outerVSpace("#folders")+"px";browser.fixFilesHeight();var a=$("#left").outerWidth()+$("#right").outerWidth();_("status").style.width=a+"px";while($("#status").outerWidth()>a){_("status").style.width=_.nopx(_("status").style.width)-1+"px"}while($("#status").outerWidth()<a){_("status").style.width=_.nopx(_("status").style.width)+1+"px"}if($.browser.msie&&($.browser.version.substr(0,1)<8)){_("right").style.width=$(window).width()-$("#left").outerWidth()+"px"}_("files").style.width=$("#right").innerWidth()-_.outerHSpace("#files")+"px";_("resizer").style.left=$("#left").outerWidth()-_.outerRightSpace("#folders","m")+"px";_("resizer").style.width=_.outerRightSpace("#folders","m")+_.outerLeftSpace("#files","m")+"px"};browser.fixFilesHeight=function(){_("files").style.height=$("#left").outerHeight()-$("#toolbar").outerHeight()-_.outerVSpace("#files")-(($("#settings").css("display")!="none")?$("#settings").outerHeight():0)+"px"};browser.drag=function(b,a){var d=a.offsetY,c=a.offsetX;if(d<0){d=0}if(c<0){c=0}if(d+$(this).outerHeight()>$(window).height()){d=$(window).height()-$(this).outerHeight()}if(c+$(this).outerWidth()>$(window).width()){c=$(window).width()-$(this).outerWidth()}$(this).css({top:d,left:c})};browser.showDialog=function(d){$("#dialog").css({left:0,top:0});this.shadow();if($("#dialog div.box")&&!$("#dialog div.title").get(0)){var a=$("#dialog div.box").html();var f=$("#dialog").data("title")?$("#dialog").data("title"):"";a='<div class="title"><span class="close"></span>'+f+"</div>"+a;$("#dialog div.box").html(a);$("#dialog div.title span.close").mousedown(function(){$(this).addClass("clicked")});$("#dialog div.title span.close").mouseup(function(){$(this).removeClass("clicked")});$("#dialog div.title span.close").click(function(){browser.hideDialog();browser.hideAlert()})}$("#dialog").drag(browser.drag,{handle:"#dialog div.title"});$("#dialog").css("display","block");if(d){var c=d.pageX-parseInt($("#dialog").outerWidth()/2);var b=d.pageY-parseInt($("#dialog").outerHeight()/2);if(c<0){c=0}if(b<0){b=0}if(($("#dialog").outerWidth()+c)>$(window).width()){c=$(window).width()-$("#dialog").outerWidth()}if(($("#dialog").outerHeight()+b)>$(window).height()){b=$(window).height()-$("#dialog").outerHeight()}$("#dialog").css({left:c+"px",top:b+"px"})}else{$("#dialog").css({left:parseInt(($(window).width()-$("#dialog").outerWidth())/2)+"px",top:parseInt(($(window).height()-$("#dialog").outerHeight())/2)+"px"})}$(document).unbind("keydown");$(document).keydown(function(g){if(g.keyCode==27){browser.hideDialog()}})};browser.hideDialog=function(){this.unshadow();if($("#clipboard").hasClass("selected")){$("#clipboard").removeClass("selected")}$("#dialog").css("display","none");$("div.folder > a > span.folder").removeClass("context");$("#dialog").html("");$("#dialog").data("title",null);$("#dialog").unbind();$("#dialog").click(function(){return false});$(document).unbind("keydown");$(document).keydown(function(a){return !browser.selectAll(a)});browser.hideAlert()};browser.showAlert=function(d){$("#alert").css({left:0,top:0});if(typeof d=="undefined"){d=true}if(d){this.shadow()}var c=parseInt(($(window).width()-$("#alert").outerWidth())/2),b=parseInt(($(window).height()-$("#alert").outerHeight())/2);var a=$(window).height();if(b<0){b=0}$("#alert").css({left:c+"px",top:b+"px",display:"block"});if($("#alert").outerHeight()>a){$("#alert div.message").css({height:a-$("#alert div.title").outerHeight()-$("#alert div.ok").outerHeight()-20+"px"})}$(document).unbind("keydown");$(document).keydown(function(f){if(f.keyCode==27){browser.hideDialog();browser.hideAlert();$(document).unbind("keydown");$(document).keydown(function(g){return !browser.selectAll(g)})}})};browser.hideAlert=function(a){if(typeof a=="undefined"){a=true}if(a){this.unshadow()}$("#alert").css("display","none");$("#alert").html("");$("#alert").data("title",null)};browser.alert=function(b,c){b=b.replace(/\r?\n/g,"<br />");var a=$("#alert").data("title")?$("#alert").data("title"):browser.label("Attention");$("#alert").html('<div class="title"><span class="close"></span>'+a+'</div><div class="message">'+b+'</div><div class="ok"><button>'+browser.label("OK")+"</button></div>");$("#alert div.ok button").click(function(){browser.hideAlert(c)});$("#alert div.title span.close").mousedown(function(){$(this).addClass("clicked")});$("#alert div.title span.close").mouseup(function(){$(this).removeClass("clicked")});$("#alert div.title span.close").click(function(){browser.hideAlert(c)});$("#alert").drag(browser.drag,{handle:"#alert div.title"});browser.showAlert(c)};browser.confirm=function(a,b){$("#dialog").data("title",browser.label("Question"));$("#dialog").html('<div class="box"><div class="question">'+browser.label(a)+'<div class="buttons"><button>'+browser.label("No")+"</button> <button>"+browser.label("Yes")+"</button></div></div></div>");browser.showDialog();$("#dialog div.buttons button").first().click(function(){browser.hideDialog()});$("#dialog div.buttons button").last().click(function(){if(b){b(function(){browser.hideDialog()})}else{browser.hideDialog()}});$("#dialog div.buttons button").get(1).focus()};browser.shadow=function(){$("#shadow").css("display","block")};browser.unshadow=function(){$("#shadow").css("display","none")};browser.showMenu=function(c){var b=c.pageX;var a=c.pageY;if(($("#dialog").outerWidth()+b)>$(window).width()){b=$(window).width()-$("#dialog").outerWidth()}if(($("#dialog").outerHeight()+a)>$(window).height()){a=$(window).height()-$("#dialog").outerHeight()}$("#dialog").css({left:b+"px",top:a+"px",display:"none"});$("#dialog").fadeIn()};browser.fileNameDialog=function(e,post,inputName,inputValue,url,labels,callBack,selectAll){var html='<form method="post" action="javascript:;"><div class="box"><input name="'+inputName+'" type="text" /><br /><div style="text-align:right"><input type="submit" value="'+_.htmlValue(this.label("OK"))+'" /> <input type="button" value="'+_.htmlValue(this.label("Cancel"))+'" onclick="browser.hideDialog(); browser.hideAlert(); return false" /></div></div></form>';$("#dialog").html(html);$("#dialog").data("title",this.label(labels.title));$('#dialog input[name="'+inputName+'"]').attr("value",inputValue);$("#dialog").unbind();$("#dialog").click(function(){return false});$("#dialog form").submit(function(){var name=this.elements[0];name.value=$.trim(name.value);if(name.value==""){browser.alert(browser.label(labels.errEmpty),false);name.focus();return}else{if(/[\/\\]/g.test(name.value)){browser.alert(browser.label(labels.errSlash),false);name.focus();return}else{if(name.value.substr(0,1)=="."){browser.alert(browser.label(labels.errDot),false);name.focus();return}}}eval("post."+inputName+" = name.value;");$.ajax({type:"POST",dataType:"json",url:url,data:post,async:false,success:function(data){if(browser.check4errors(data,false)){return}if(callBack){callBack(data)}browser.hideDialog()},error:function(){browser.alert(browser.label("Unknown error."),false)}});return false});browser.showDialog(e);$("#dialog").css("display","block");$('#dialog input[type="submit"]').click(function(){return $("#dialog form").submit()});var field=$('#dialog input[type="text"]');var value=field.attr("value");if(!selectAll&&/^(.+)\.[^\.]+$/.test(value)){value=value.replace(/^(.+)\.[^\.]+$/,"$1");_.selection(field.get(0),0,value.length)}else{field.get(0).focus();field.get(0).select()}};browser.orderFiles=function(callBack,selected){var order=_.kuki.get("order");var desc=(_.kuki.get("orderDesc")=="on");if(!browser.files||!browser.files.sort){browser.files=[]}browser.files=browser.files.sort(function(a,b){var a1,b1,arr;if(!order){order="name"}if(order=="date"){a1=a.mtime;b1=b.mtime}else{if(order=="type"){a1=_.getFileExtension(a.name);b1=_.getFileExtension(b.name)}else{if(order=="size"){a1=a.size;b1=b.size}else{eval("a1 = a."+order+".toLowerCase(); b1 = b."+order+".toLowerCase();")}}}if((order=="size")||(order=="date")){if(a1<b1){return desc?1:-1}if(a1>b1){return desc?-1:1}}if(a1==b1){a1=a.name.toLowerCase();b1=b.name.toLowerCase();arr=[a1,b1];arr=arr.sort();return(arr[0]==a1)?-1:1}arr=[a1,b1];arr=arr.sort();if(arr[0]==a1){return desc?1:-1}return desc?-1:1});browser.showFiles(callBack,selected);browser.initFiles()};browser.humanSize=function(a){if(a<1024){a=a.toString()+" B"}else{if(a<1048576){a/=1024;a=parseInt(a).toString()+" KB"}else{if(a<1073741824){a/=1048576;a=parseInt(a).toString()+" MB"}else{if(a<1099511627776){a/=1073741824;a=parseInt(a).toString()+" GB"}else{a/=1099511627776;a=parseInt(a).toString()+" TB"}}}}return a};browser.baseGetData=function(a){var b="browse.php?type="+encodeURIComponent(this.type)+"&lng="+this.lang;if(a){b+="&act="+a}if(this.cms){b+="&cms="+this.cms}return b};browser.label=function(b,c){var a=this.labels[b]?this.labels[b]:b;if(c){$.each(c,function(d,e){a=a.replace("{"+d+"}",e)})}return a};browser.check4errors=function(a,c){if(!a.error){return false}var b;if(a.error.join){b=a.error.join("\n")}else{b=a.error}browser.alert(b,c);return true};browser.post=function(a,c){var b='<form id="postForm" method="POST" action="'+a+'">';$.each(c,function(d,e){if($.isArray(e)){$.each(e,function(g,f){b+='<input type="hidden" name="'+_.htmlValue(d)+'[]" value="'+_.htmlValue(f)+'" />'})}else{b+='<input type="hidden" name="'+_.htmlValue(d)+'" value="'+_.htmlValue(e)+'" />'}});b+="</form>";$("#dialog").html(b);$("#dialog").css("display","block");$("#postForm").get(0).submit()};browser.fadeFiles=function(){$("#files > div").css({opacity:"0.4",filter:"alpha(opacity:40)"})};browser.initSettings=function(){if(!this.shows.length){var d=$('#show input[type="checkbox"]').toArray();$.each(d,function(f,e){browser.shows[f]=e.name})}var a=this.shows;if(!_.kuki.isSet("showname")){_.kuki.set("showname","on");$.each(a,function(e,f){if(f!="name"){_.kuki.set("show"+f,"off")}})}$('#show input[type="checkbox"]').click(function(){var e=$(this).get(0).checked?"on":"off";_.kuki.set("show"+$(this).get(0).name,e);if($(this).get(0).checked){$("#files .file div."+$(this).get(0).name).css("display","block")}else{$("#files .file div."+$(this).get(0).name).css("display","none")}});$.each(a,function(e,g){var f=(_.kuki.get("show"+g)=="on")?"checked":"";$('#show input[name="'+g+'"]').get(0).checked=f});if(!this.orders.length){var c=$('#order input[type="radio"]').toArray();$.each(c,function(f,e){browser.orders[f]=e.value})}var b=this.orders;if(!_.kuki.isSet("order")){_.kuki.set("order","name")}if(!_.kuki.isSet("orderDesc")){_.kuki.set("orderDesc","off")}$('#order input[value="'+_.kuki.get("order")+'"]').get(0).checked=true;$('#order input[name="desc"]').get(0).checked=(_.kuki.get("orderDesc")=="on");$('#order input[type="radio"]').click(function(){_.kuki.set("order",$(this).get(0).value);browser.orderFiles()});$('#order input[name="desc"]').click(function(){_.kuki.set("orderDesc",$(this).get(0).checked?"on":"off");browser.orderFiles()});if(!_.kuki.isSet("view")){_.kuki.set("view","thumbs")}if(_.kuki.get("view")=="list"){$("#show input").each(function(){this.checked=true});$("#show input").each(function(){this.disabled=true})}$('#view input[value="'+_.kuki.get("view")+'"]').get(0).checked=true;$("#view input").click(function(){var e=$(this).attr("value");if(_.kuki.get("view")!=e){_.kuki.set("view",e);if(e=="list"){$("#show input").each(function(){this.checked=true});$("#show input").each(function(){this.disabled=true})}else{$.each(browser.shows,function(f,g){$('#show input[name="'+g+'"]').get(0).checked=(_.kuki.get("show"+g)=="on")});$("#show input").each(function(){this.disabled=false})}}browser.refresh()})};browser.initToolbar=function(){$("#toolbar a").click(function(){browser.hideDialog()});if(!_.kuki.isSet("displaySettings")){_.kuki.set("displaySettings","off")}if(_.kuki.get("displaySettings")=="on"){$('#toolbar a[href="kcact:settings"]').addClass("selected");$("#settings").css("display","block");browser.resize()}$('#toolbar a[href="kcact:settings"]').click(function(){if($("#settings").css("display")=="none"){$(this).addClass("selected");_.kuki.set("displaySettings","on");$("#settings").css("display","block");browser.fixFilesHeight()}else{$(this).removeClass("selected");_.kuki.set("displaySettings","off");$("#settings").css("display","none");browser.fixFilesHeight()}return false});$('#toolbar a[href="kcact:refresh"]').click(function(){browser.refresh();return false});if(window.opener||this.opener.TinyMCE||$("iframe",window.parent.document).get(0)){$('#toolbar a[href="kcact:maximize"]').click(function(){browser.maximize(this);return false})}else{$('#toolbar a[href="kcact:maximize"]').css("display","none")}$('#toolbar a[href="kcact:about"]').click(function(){var a='<div class="box about"><div class="head"><a href="http://kcfinder.sunhater.com" target="_blank">KCFinder</a> '+browser.version+"</div>";if(browser.support.check4Update){a+='<div id="checkver"><span class="loading"><span>'+browser.label("Checking for new version...")+"</span></span></div>"}a+="<div>"+browser.label("Licenses:")+" GPLv2 & LGPLv2</div><div>Copyright &copy;2010, 2011 Pavel Tzonkov</div><button>"+browser.label("OK")+"</button></div>";$("#dialog").html(a);$("#dialog").data("title",browser.label("About"));browser.showDialog();var c=function(){browser.hideDialog();browser.unshadow()};$("#dialog button").click(c);var b=$("#checkver > span");setTimeout(function(){$.ajax({dataType:"json",url:browser.baseGetData("check4Update"),async:true,success:function(d){if(!$("#dialog").html().length){return}b.removeClass("loading");if(!d.version){b.html(browser.label("Unable to connect!"));browser.showDialog();return}if(browser.version<d.version){b.html('<a href="http://kcfinder.sunhater.com/download" target="_blank">'+browser.label("Download version {version} now!",{version:d.version})+"</a>")}else{b.html(browser.label("KCFinder is up to date!"))}browser.showDialog()},error:function(){if(!$("#dialog").html().length){return}b.removeClass("loading");b.html(browser.label("Unable to connect!"));browser.showDialog()}})},1000);$("#dialog").unbind();return false});this.initUploadButton()};browser.initUploadButton=function(){var b=$('#toolbar a[href="kcact:upload"]');if(!this.access.files.upload){b.css("display","none");return}var d=b.get(0).offsetTop;var c=b.outerWidth();var a=b.outerHeight();$("#toolbar").prepend('<div id="upload" style="top:'+d+"px;width:"+c+"px;height:"+a+'px"><form enctype="multipart/form-data" method="post" target="uploadResponse" action="'+browser.baseGetData("upload")+'"><input type="file" name="upload[]" onchange="browser.uploadFile(this.form)" style="height:'+a+'px" multiple="multiple" /><input type="hidden" name="dir" value="" /></form></div>');$("#upload input").css("margin-left","-"+($("#upload input").outerWidth()-c)+"px");$("#upload").mouseover(function(){$('#toolbar a[href="kcact:upload"]').addClass("hover")});$("#upload").mouseout(function(){$('#toolbar a[href="kcact:upload"]').removeClass("hover")})};browser.uploadFile=function(a){if(!this.dirWritable){browser.alert(this.label("Cannot write to upload folder."));$("#upload").detach();browser.initUploadButton();return}a.elements[1].value=browser.dir;$('<iframe id="uploadResponse" name="uploadResponse" src="javascript:;"></iframe>').prependTo(document.body);$("#loading").html(this.label("Uploading file..."));$("#loading").css("display","inline");a.submit();$("#uploadResponse").load(function(){var b=$(this).contents().find("body").html();$("#loading").css("display","none");b=b.split("\n");var c=[],d=[];$.each(b,function(e,f){if(f.substr(0,1)=="/"){c[c.length]=f.substr(1,f.length-1)}else{d[d.length]=f}});if(d.length){browser.alert(d.join("\n"))}if(!c.length){c=null}browser.refresh(c);$("#upload").detach();setTimeout(function(){$("#uploadResponse").detach()},1);browser.initUploadButton()})};browser.maximize=function(f){if(window.opener){window.moveTo(0,0);b=screen.availWidth;j=screen.availHeight;if($.browser.opera){j-=50}window.resizeTo(b,j)}else{if(browser.opener.TinyMCE){var g,d,a;$("iframe",window.parent.document).each(function(){if(/^mce_\d+_ifr$/.test($(this).attr("id"))){a=parseInt($(this).attr("id").replace(/^mce_(\d+)_ifr$/,"$1"));g=$("#mce_"+a,window.parent.document);d=$("#mce_"+a+"_ifr",window.parent.document)}});if($(f).hasClass("selected")){$(f).removeClass("selected");g.css({left:browser.maximizeMCE.left+"px",top:browser.maximizeMCE.top+"px",width:browser.maximizeMCE.width+"px",height:browser.maximizeMCE.height+"px"});d.css({width:browser.maximizeMCE.width-browser.maximizeMCE.Hspace+"px",height:browser.maximizeMCE.height-browser.maximizeMCE.Vspace+"px"})}else{$(f).addClass("selected");browser.maximizeMCE={width:_.nopx(g.css("width")),height:_.nopx(g.css("height")),left:g.position().left,top:g.position().top,Hspace:_.nopx(g.css("width"))-_.nopx(d.css("width")),Vspace:_.nopx(g.css("height"))-_.nopx(d.css("height"))};var b=$(window.parent).width();var j=$(window.parent).height();g.css({left:$(window.parent).scrollLeft()+"px",top:$(window.parent).scrollTop()+"px",width:b+"px",height:j+"px"});d.css({width:b-browser.maximizeMCE.Hspace+"px",height:j-browser.maximizeMCE.Vspace+"px"})}}else{if($("iframe",window.parent.document).get(0)){var e=$('iframe[name="'+window.name+'"]',window.parent.document);var h=e.parent();var b,j;if($(f).hasClass("selected")){$(f).removeClass("selected");if(browser.maximizeThread){clearInterval(browser.maximizeThread);browser.maximizeThread=null}if(browser.maximizeW){browser.maximizeW=null}if(browser.maximizeH){browser.maximizeH=null}$.each($("*",window.parent.document).get(),function(k,l){l.style.display=browser.maximizeDisplay[k]});e.css({display:browser.maximizeCSS.display,position:browser.maximizeCSS.position,left:browser.maximizeCSS.left,top:browser.maximizeCSS.top,width:browser.maximizeCSS.width,height:browser.maximizeCSS.height});$(window.parent).scrollLeft(browser.maximizeLest);$(window.parent).scrollTop(browser.maximizeTop)}else{$(f).addClass("selected");browser.maximizeCSS={display:e.css("display"),position:e.css("position"),left:e.css("left"),top:e.css("top"),width:e.outerWidth()+"px",height:e.outerHeight()+"px"};browser.maximizeTop=$(window.parent).scrollTop();browser.maximizeLeft=$(window.parent).scrollLeft();browser.maximizeDisplay=[];$.each($("*",window.parent.document).get(),function(k,l){browser.maximizeDisplay[k]=$(l).css("display");$(l).css("display","none")});e.css("display","block");e.parents().css("display","block");var c=function(){b=$(window.parent).width();j=$(window.parent).height();if(!browser.maximizeW||(browser.maximizeW!=b)||!browser.maximizeH||(browser.maximizeH!=j)){browser.maximizeW=b;browser.maximizeH=j;e.css({width:b+"px",height:j+"px"});browser.resize()}};e.css("position","absolute");if((e.offset().left==e.position().left)&&(e.offset().top==e.position().top)){e.css({left:"0",top:"0"})}else{e.css({left:-e.offset().left+"px",top:-e.offset().top+"px"})}c();browser.maximizeThread=setInterval(c,250)}}}}};browser.refresh=function(a){this.fadeFiles();$.ajax({type:"POST",dataType:"json",url:browser.baseGetData("chDir"),data:{dir:browser.dir},async:false,success:function(b){if(browser.check4errors(b)){return}browser.dirWritable=b.dirWritable;browser.files=b.files?b.files:[];browser.orderFiles(null,a);browser.statusDir()},error:function(){$("#files > div").css({opacity:"",filter:""});$("#files").html(browser.label("Unknown error."))}})};